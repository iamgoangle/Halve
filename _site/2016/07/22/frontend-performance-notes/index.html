<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Frontend Engineer - Thinking about performance &#8211; Teerapong Singthong</title> <meta name="description" content=""> <meta name="keywords" content="performance, browser, javascript"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="golf-logo.png"> <meta name="twitter:title" content="Frontend Engineer - Thinking about performance"> <meta name="twitter:description" content=""> <meta name="twitter:site" content="@iamgoangle"> <meta name="twitter:creator" content="@iamgoangle"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Frontend Engineer - Thinking about performance"> <meta property="og:description" content=""> <meta property="og:url" content="https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/"> <meta property="og:site_name" content="Teerapong Singthong"> <meta property="og:image" content="https://iamgoangle.github.io/images/golf-logo.png"> <link rel="canonical" href="https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://iamgoangle.github.io/feed.xml" title="Teerapong Singthong" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://iamgoangle.github.io/favicon.png" /> <link rel="shortcut icon" href="https://iamgoangle.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://iamgoangle.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://iamgoangle.github.io/images/post-wall.png) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://iamgoangle.github.io/images/12043050_982005851847216_7927084816037540014_n.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://iamgoangle.github.io/images/golf-home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://iamgoangle.github.io" class="logo"><img src="https://iamgoangle.github.io/images/golf-logo.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Frontend Engineer - Thinking about performance </h1> <ul class="tags"> <li><a href="https://iamgoangle.github.io/tags#performance">performance</a></li> <li><a href="https://iamgoangle.github.io/tags#browser">browser</a></li> <li><a href="https://iamgoangle.github.io/tags#javascript">javascript</a></li> </ul> <div class="section-line reverse"><a href="https://iamgoangle.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">22 Jul 2016</div> <h2 id="performance-">เราให้ความสำคัญกับ Performance มากแค่ไหน?</h2> <p>ทุกวันนี้อัตราความเร็วเครื่องคอมพิวเตอร์ หรือ มือถือ รวมไปถึง Smart devices ต่างๆที่สามารถเชื่อมต่ออินเตอร์เนตได้ กำลังแข่งขันกันในเรื่องความเร็วในการประมวลผล แน่นอนว่าความเร็วที่แข่งขันกันอยู่นั้น มันก็เป็นผลดีต่อผู้บริโภค ที่สามารถมีตัวเลือกมากมาย</p> <p>ผู้บริโภคโดยส่วนใหญ่ใช้อุปกรณ์เหล่านี้ในการเข้าเวปไซต์ ใช่ไหมครับ? คำตอบ คือ ใช่ และเป็นที่แน่นอนว่า การใช้ทรัพยากรของเครื่อง เพื่อเปิดสักเวปไซต์นึงนี่ มันกินทรัพยากรไม่มากหรอก</p> <p>มันก็จริง! แต่นั่นมันอาจทำให้เราไม่ได้ใส่ใจกับเรื่อง Performance เพราะ เราคิดไปเองว่าคอมพิวเตอร์เดียวนี้มันแรง</p> <p>แต่อย่าลืมว่า แม้ว่าเครื่องของผู้ใช้จะแรงเพียงใด แต่การออกแบบ Frontend ที่ไม่ได้ใส่ใจกับเรื่อง Performance มันก็ตอบสนองผู้ใช้ช้าอยู่ดี และรวมไปถึง User Experience ที่แย่อีกด้วย</p> <h2 id="frontend-optimization-">ถ้าเราจะเริ่มต้น Frontend Optimization เราควรมองปัจจัยอะไรบ้าง?</h2> <p>มีคำที่กล่าวว่า “Personal experience all tell us the fast is best” ดังนั้น เราลองมาพิจารณาเรื่องเล็กน้อยที่เราควรปรับปรุงเวปไซต์ของเราให้ดีขึ้น เช่น ่</p> <ol> <li> <p>ความเร็วในการแสดงผล</p> </li> <li> <p>ความเร็วในการตอบสนอง</p> </li> <li> <p>การทำงานเบื้องหน้า เบื้องหลังต้องดีเยี่ยม</p> </li> <li> <p>ลด HTTP Request ที่ไม่จำเป็น</p> </li> <li> <p>เข้าใจธรรมชาติของ Web Browser</p> </li> </ol> <h2 id="browser-">เข้าใจธรรมชาติของ Browser กันแบบคร่าวๆกันก่อน</h2> <p>ก่อนที่ Web Browser สักหนึ่งตัวจะแสดงผล HTML ที่เราเขียน ออกมาบนหน้าจอ Browser มีสิ่งที่เรียกว่า Browser Rendering Engine หรือ มันคือเครื่องมือที่ Browser ใช้ตีความ และทำความเข้าใจ HTML ที่เขียนไว้</p> <div class="highlighter-rouge"><pre class="highlight"><code>Different browsers use different rendering engines: Internet Explorer uses Trident, Firefox uses Gecko, Safari uses WebKit. Chrome and Opera (from version 15) use Blink, a fork of WebKit.

WebKit is an open source rendering engine which started as an engine for the Linux platform and was modified by Apple to support Mac and Windows. See webkit.org for more details.
</code></pre></div> <p>Ref: <a href="http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/">http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/</a></p> <p>คราวนี้มาดูขั้นตอนการทำงานคร่าวๆกัน</p> <ol> <li> <p>Rendering engine ทำการรับ content html ที่ download มาผ่านทาง Network Layer จากนั้น ทำการแบ่งข้อมูลออกเป็นก้อนๆ ตีความว่า ก้อนละ 8kb มองเป็นเค้กก้อนละ 8kb ก็ได้</p> </li> <li> <p>Parsing HTML และแปลงเป็น DOM เพื่อให้ ออกมาอยู่ในรูปแบบ Tree Structure หรือ โครงสร้างต้นไม้</p> </li> <li> <p>มาถึงจุดสำคัญละครับ !!! ในจุดนี้เองถ้า Rendering Engine พบว่า มี External resource เช่น <code class="highlighter-rouge">&lt;script src=""&gt;</code> หรือ <code class="highlighter-rouge">&lt;link rel=""&gt;</code> หรือสคริปจำพวกการโหลดไฟล์ ตัว Rendering Engine จะหยุด หยุดจริงๆครับ และทำการ Execute ตีความจนเสร็จ</p> </li> <li> <p>เมื่อเสร็จสิ้นกระบวนการเกี่ยวกับ Javascript, Stylesheet ตัว Rendering engine จะทำการสร้าง Render Tree</p> </li> <li> <p>จากนั้นก็ Parsing html to DOM ไปเรื่อยๆจนเสร็จ</p> </li> <li> <p>ยังไม่จบ!! Rendering Engine จะเข้าสู่กระบวนการต่อ ที่เรียกว่า Layout process เพื่อบอก Browser ว่า element ต่อไปนี้ ควรอยู่จัดใดของหน้าเว็ป</p> </li> <li> <p>และกระบวนการสุดท้าย ก็คือ นำ Render Tree มาผนวกกับ Layout process เพื่อรวม Style และแสดงผลบนหน้าจออย่างสวยงาม</p> </li> </ol> <p>Ref: <a href="http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/">http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/</a> <a href="https://armno.github.io/2016/01/28/how-web-browsers-work">https://armno.github.io/2016/01/28/how-web-browsers-work</a></p> <h2 id="section">และแล้วเราก็เจอปัญหาจนได้</h2> <p>จากการทำงานคร่าวๆของ Browser เราจับใจความได้ว่า มันทำงาน แบบ Synchronously execute นี่หว่า แม่งศัพท์เทคนิคอีกละ !! ก็คือ มันหยุดรอครับ เมื่อเจอ script เกี่ยวกับ JavaScript, CSS แล้วจะเกิดอะไรขึ้นที่หน้าจอของผู้ใช้ นั่นก็คือ หน้าขาวๆ นิ่งๆ ที่รอโหลด</p> <p>สิ่งนี้เรียกว่า <code class="highlighter-rouge">Browser render-blocking-resources</code> แต่ก็อย่างที่บอกครับ โลกของการทำให้ Performance ในส่วนของ Frontend ดีขึ้น ไม่ใช่แค่ แก้เรื่อง Browser render-blocking-resources ครับ</p> <h2 id="solutions">Solutions</h2> <ol> <li> <p>Browser render blocking resources <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-blocking-css?hl=en">CSS</a> <a href="https://developers.google.com/speed/docs/insights/BlockingJS">JS</a></p> </li> <li> <p>Make Fewer Requests</p> </li> <li> <p>Maximising parallelisation</p> </li> <li> <p>ใช้ CDN (Content Delivery Network) แทนการอ้างสคริปภายใต้ domain web server ของเรา</p> </li> <li> <p>HTTP requests and DNS lookups</p> </li> <li> <p>DNS prefetching</p> </li> <li> <p>Make JavaScript Asynchronous</p> </li> <li> <p>Make Inline CSS/Javascript เท่าที่จำเป็น เฉพาะส่วนที่ critical กับผู้ใช้จริงๆ</p> </li> <li> <p>Minify HTML/CSS/JS</p> </li> <li> <p>RESTFul APIs need to be only return minimal value via header instead body</p> </li> </ol> <br> <a href="https://twitter.com/intent/tweet?text=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://iamgoangle.github.io/2016/07/22/frontend-performance-notes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://iamgoangle.github.io/2016/07/05/getting-started-with-expressjs/" class="pagination_pager" title="เริ่มต้นสร้าง Web Application project ด้วย Express.JS ">previous</a> <a href="#" class="pagination_pager disabled">next</a> </nav> </div> </div> <!-- JS --> <script src="https://iamgoangle.github.io/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
